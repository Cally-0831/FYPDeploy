<div class="Pagetitle">All submitted Unavailable timeslots</div>
<div>
    <% if (req.session.role=="sup" ){%>
        <table class="table is-bordered is-striped is-hoverable is-fullwidth">
            <th style="font-size:20px;text-align: center;vertical-align:center;">ReqID</th>
            <th style="font-size:20px;text-align: center;vertical-align:center;">Unavaildable date</th>
            <th style="font-size:20px;text-align: center;vertical-align:center;">Start Time</th>
            <th style="font-size:20px;text-align: center;vertical-align:center;">EndTime</th>
            <th style="font-size:20px;text-align: center;vertical-align:center;">
                Action
            </th>

            <% thisuserRequestlist.forEach( function(request) {
                const StartDay=new Date(request.RequestDate).toLocaleDateString('en-CA'); %>
                
                <tr>
                    <td style="text-align: center;vertical-align:center;">
                        <%= request.ReqID %>
                    </td>
                    <td style="text-align: center;vertical-align:center;">
                        <%= StartDay %>
                    </td>

                    <td style="text-align: center;vertical-align:center;">
                        <%= request.RequestStartTime %>
                    </td>
                    <td style="text-align: center;vertical-align:center;">
                        <%= request.RequestEndTime%>
                    </td>
                    <td style="text-align: center;vertical-align:center;">
                        <button class="button" type="button"
                            onclick="deleterequestfromsupervisor('<%= request.ReqID %>')">Delete</button>
                    </td>
                </tr>

                <% }); %>

        </table>
        <%}else if(req.session.role=="stu" ) {%>
            <table class="table is-bordered is-striped is-hoverable is-fullwidth">
                <th style="font-size:20px;text-align: center;vertical-align:center;">ReqID</th>
                <th style="font-size:20px;text-align: center;vertical-align:center;">Unavaildable date</th>
                <th style="font-size:20px;text-align: center;vertical-align:center;">Start Time</th>
                <th style="font-size:20px;text-align: center;vertical-align:center;">EndTime</th>
                <th style="font-size:20px;text-align: center;vertical-align:center;">Status</th>
                <th style="font-size:20px;text-align: center;vertical-align:center;">Action</th>
    
                <% thisuserRequestlist.forEach( function(request) {
                    const StartDay=new Date(request.RequestDate).toLocaleDateString('en-CA'); %>
                    
                    <tr>
                        <td style="text-align: center;vertical-align:center;">
                            <%= request.ReqID %>
                        </td>
                        <td style="text-align: center;vertical-align:center;">
                            <%= StartDay %>
                        </td>
                        <td style="text-align: center;vertical-align:center;">
                            <%= request.RequestStartTime %>
                        </td>
                        <td style="text-align: center;vertical-align:center;">
                            <%= request.RequestEndTime%>
                        </td>
                        <td id ="status" style="text-align: center;vertical-align:center;">
                            <%= request.status%>
                        </td>
                        <td style="text-align: center;vertical-align:center;">
                            <button class="button" type="button"
                                onclick="deleterequestfromstudent('<%= request.ReqID %>','<%= request.status %>')">Delete</button>
                        </td>
                    </tr>
    
                    <% }); %>
    
            </table>
            <%}%>


</div>

<script>
    async function deleterequestfromstudent(reqid,status) {
        var r = confirm("Confirm Delete " + reqid+" ?");
        var requestBody = JSON.stringify({ ReqID: reqid });
        if (r) {

            var response = await fetch("/user/checkrequest", {
                method: "DELETE",
                body: requestBody
            });

            if (response.ok) {
                // var html = await response.text();
                // alert(html);

                alert("Request deleted.");
                location.assign("/user/checkrequest");
            } else {
                alert(response.status + ": " + response.statusText);
            }

        } else {
            alert("cancelled");
        }
    }
    async function deleterequestfromsupervisor(reqid) {
        var r = confirm("Confirm Delete " + reqid+" ?");
        var requestBody = JSON.stringify({ ReqID: reqid });
        if (r) {

            var response = await fetch("/user/checkrequest", {
                method: "DELETE",
                body: requestBody
            });

            if (response.ok) {
                // var html = await response.text();
                // alert(html);

                alert("Request deleted.");
                location.assign("/user/checkrequest");
            } else {
                alert(response.status + ": " + response.statusText);
            }

        } else {
            alert("cancelled");
        }
    };

</script>