<div>
    this is Scheduling
    <br>
    havedraft = <%=havedraft%>
        Waring = <%=warning%>
            Msg = <%=msg%>

                <br>
                Presentdate = <%=presentstartday%> - <%=presentendday%>
                        <br>
                        Releasescheduleday = <%=realreleaseday%>
                            <div class="Pagetitle"> Schedule Design</div>
                            <div class="row">
                                <div class="buttons">
                                    <div class="button buttonlogout" onclick="backback()">Back</div>
                                </div>
                            </div>
                            <%if (warning=="401" && msg !="4&" ){%>
                                <div class="columns is-centered">
                                    <div class="column is-half">
                                        <article class="message is-danger">
                                            <div class="message-header" style="font-size: 25px;">
                                                <p>Cannot Design Schedule Now</p>

                                            </div>
                                            <div class="message-body" style="font-size: 20px;">
                                                Cannot design the Presentation Schedule now since the settings for
                                                accpecting
                                                student's timetable and requests are still ongoing.
                                            </div>
                                        </article>
                                    </div>
                                </div>
                                <%}else if(warning=="200" && msg=="4&" ){%>
                                    <div class="columns is-centered">
                                        <div id="create" class="column is-half">
                                            <div class="scheduledesignchecking">
                                                <div class="row">
                                                    <div style="font-size: 25px; font-weight: bold;">
                                                        Schedule Design
                                                    </div>


                                                </div>
                                                <br>
                                                <div class="row">
                                                    <div style="font-size: 20px; ">
                                                        Present Period = <u>
                                                            <%=presentstartday.toLocaleDateString()%>
                                                                <%=presentstartday.toLocaleTimeString("en-US")%>
                                                        </u> to <u>
                                                            <%=presentendday.toLocaleDateString()%>
                                                                <%=presentendday.toLocaleTimeString("en-US")%>
                                                        </u>
                                                    </div>
                                                    <br>
                                                    <div class="control" id="typeofpresentation">
                                                        <label class="radio">
                                                            <input type="radio" name="typeofpresent" value="midterm">
                                                            Midterm Present
                                                        </label>
                                                        <label class="radio">
                                                            <input type="radio" name="typeofpresent" value="final"
                                                                checked>
                                                            Final Present
                                                        </label>
                                                    </div>
                                                    <div class="buttons is-right">

                                                        <div class="button buttonlogout"
                                                            onclick="confirmcreate('<%=presentstartday%>','<%=presentendday%>')">
                                                            Create Draft
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <%}%>

</div>
<script>
    function backback() {
        location.assign("/home");
    }

    async function confirmcreate(startdaydatetype, enddaydatetype) {
        var r = confirm("Confirm to create ?");
        var boxlist = [];

        if (r) {
            var typeofpresentlist = document.getElementsByName("typeofpresent");
            var typeofpresent;

            for (var i = 0; i < typeofpresentlist.length; i++) {
                if (typeofpresentlist[i].checked) {
                    typeofpresent = typeofpresentlist[i].value;
                }
            }
            var requestbody = JSON.stringify({typeofpresent: typeofpresent})
            console.log(requestbody)
            var response = await fetch("/scheduledesign/genavailable", {
                method: "POST",
                body: requestbody
            });

            var response = await fetch("/scheduledesign/getpairing", {
                method: "GET"
            });

            /**
            var pairinglist = (await response.json()).pairinglist;
            console.log(pairinglist)
            let pairinglistdistictsup = (pairinglist) => {
                let unique_values = pairinglist
                    .map((item) => item.tid)
                    .filter(
                        (value, index, current_value) => current_value.indexOf(value) === index
                    );
                return unique_values;
            };
            var suplist = pairinglistdistictsup(pairinglist);
            console.log(suplist)
            var indexofdistinctsuplist = 0;
            var startday = (new Date(startdaydatetype)).toLocaleDateString("en-GB").split("/")
            var endday = (new Date(enddaydatetype)).toLocaleDateString("en-GB").split("/")
            startday = startday[2] + "-" + startday[1] + "-" + startday[0]
            endday = endday[2] + "-" + endday[1] + "-" + endday[0]
           

            for (var a = 0; a < pairinglist.length; a++) {
                //for (var a = pairinglist.length - 3; a < pairinglist.length; a++) {
                var requestbody = JSON.stringify({
                    tid: pairinglist[a].tid,
                    sid: pairinglist[a].sid,
                    oid: pairinglist[a].oid,
                    suppriority : pairinglist[a].suppriority,
                    obspriority : pairinglist[a].obspriority,
                    startdaydate: startday,
                    enddaydate: endday,
                    fullstartday: new Date(startdaydatetype),
                    fullendday: new Date(enddaydatetype),
                    typeofpresent: typeofpresent,
                    boxlist: boxlist,
                })

                var response2 = await fetch("/createschedule/", {
                    method: "POST",
                    body: requestbody,
                });

                var response2 = await fetch("/createschedule/createdraft", {
                    method: "POST",
                    body: requestbody,
                });


                if (response2.ok) {
                    var response2json = await response2.json();
            

                    if (pairinglist[a].tid != suplist[indexofdistinctsuplist] || a == pairinglist.length - 1) {
                        if (a == pairinglist.length - 1) { boxlist.push(response2json); }
                        var requestbody = JSON.stringify({
                            fullstartday: new Date(startdaydatetype),
                            fullendday: new Date(enddaydatetype),
                            boxlist: boxlist,
                        })
                        console.log(requestbody.toString());

                       
                        var response3 = await fetch("/createschedule/createdraft/savebox", {
                            method: "POST",
                            body: requestbody,
                        });
                       

                        var response3 = await fetch("/createschedule/createdraft/checkpref", {
                            method: "POST",
                            body: requestbody,
                        });
                        boxlist = [];
                        indexofdistinctsuplist++;


                    }
                    boxlist.push(response2json);
                } else {
                    var response2json = await response2.json();
                    console.log(response2json)
                }


            }**/
        }
        
    }
</script>